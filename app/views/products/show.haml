.container-fluid
	%h1.text-center.text-md-left.shadow.bg-gray-900.text-light.rotate-neg.d-inline-block.px-5 #{@product.name}

	- if @product.uploads.attached?
		.row.slider.my-4
			- @product.uploads.each do |u|
				= image_tag(u.variant(resize: '300x200').processed)

	.container-fluid
		.row
			- if user_signed_in? && !left_review?
				= link_to "Write a Review", new_product_review_path(@product), class: "btn btn-primary my-3 mr-3"

			- if user_signed_in?
				=link_to new_product_upload_path(@product), class: 'btn btn-secondary my-3' do
					=image_tag('camera.svg', class: "icon mt-n2")
					%span Add Photos

	.bg-white.shadow.d-inline-block.px-4.py-3.mt-3
		- if has_reviews?
			- rating_average(@product.reviews).round.times do
				= image_tag('butcher.svg', class: 'svg')
			- (5 - rating_average(@product.reviews).round).times do
				= image_tag('butcher_blank.svg', class: 'svg')
			- if @product.reviews.length == 1
				%span / #{@product.reviews.length} review
			- elsif @product.reviews.length > 1
				%span / #{@product.reviews.length} reviews
		- else
			%p This cereal currently has no reviews.

	- if has_reviews?
		.container-fluid
			.row
				%h2.shadow.bg-gray-900.text-light.rotate.d-inline-block.mb-4.px-5 Reviews
			- @product.reviews.each do |r|
				.row.mb-5
					.col-3
						.bg-white.shadow.shadow-hover.text-center.my-3.p-3
							- if r.user.avatar.present?
								= image_tag(r.user.thumbnail, class:"img-fluid rounded")
							%h3.responsive-font.mt-3= link_to r.user.username, user_path(r.user.id), class: 'stretched-link'
					.col-9.bg-yellow.shadow.underlap.p-4
						.row.px-4
							.col-2.col-md-1.border.border-dark.border-right-0.d-flex.align-items-center.justify-content-center
								=image_tag('form/review.png', class: 'icon m-1')
							.col-10.col-md-11.border.border-dark
								%h3.text-center Cereal Incident Report Form
						.row.px-4
							.col-12.text-break.border.border-dark.border-bottom-0.bg-opacity.px-1
								%div 1. Rating Scale
							.col-12.border.border-dark.border-bottom-0.p-1
								= image_tag("#{r.rating}star.png")
							.col-12.text-break.border.border-dark.border-bottom-0.bg-opacity.px-1
								%div 2. Specific Description of Incident
							.col-12.border.border-dark
								%p= r.comment
						.row.mt-4.d-flex.justify-content-between
							.col-5
								.border-bottom.border-dark.rounded-0.px-1.cursive-font
									= current_user.username
								.d-block.m-0.px-1 Signature of Person Submitting Report
							.col-5
								.border-bottom.border-dark.rounded-0.px-1
									= r.created_at.strftime("%B %-d, %Y")
								.d-block.m-0.px-1 Date Report Submitted
							.col-5.mt-4
								.border-bottom.border-dark.rounded-0.px-1
									= current_user.username
								.d-block.m-0.px-1 Name of Person Submitting Report
						.row.mt-4
							- if user_signed_in? && owns_review?(r)
								.col-12
									= link_to "Revise or Follow Up on Report", edit_product_review_path(@product, r), class: "p-2"
								.col-12
									= link_to "Terminate Report", product_review_path(@product, r), :data => {:confirm => 'Are you sure you want to delete your review?'}, :method => :delete, class: "p-2"